<app-header></app-header>

<div class="container-fluid bgpad" *ngIf="!IsDetailPage">
    <div class="row">
        <div class="products-container">
            <div class="products-header">
                <h1>Order List</h1>
            </div>

            <div class="statistics-section">
                <div class="stat-card" *ngFor="let stat of statistics">
                    <div class="stat-title">
                        {{ stat.title }}
                    </div>
                    <div class="stat-main-row">
                        <div class="stat-left">
                            <div class="stat-amount">{{ stat.amount }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subcategory-section">
                <div class="category-section">
                    <div class="subcategory-tabs">
                        <button *ngFor="let tab of tabs" [class.active]="activeTab === tab" (click)="setActiveTab(tab)"
                            class="subcategory-tab">
                            {{ tab }}
                        </button>
                    </div>
                    <div class="right-actions">
                        <div class="search-section">
                            <input type="text" placeholder="Search your product" [(ngModel)]="searchTerm"
                                (ngModelChange)="onSearchChange($event)" class="search-input">
                            <div class="search-icon">
                                <img src="../../../assets/Icon-3.png">
                            </div>
                        </div>

                        <span class="sort-icon">
                            <img src="../../../assets/sort1.png">
                        </span>
                    </div>
                </div>

                <div class="table-section">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Order Id</th>
                                <th>Product</th>
                                <th>Date</th>
                                <th>Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                    </table>
                </div>


                <div class="table-wrapper">
                    <div class="table-scroll-container">
                        <table class="products-table">
                            <tbody>
                                <tr *ngFor="let product of Mainproducts; let i = index"
                                    (click)="DisplayOrderDetails(product)">
                                    <td>{{ ((pagination.currentPage - 1) * pagination.pageSize) + i + 1 }}</td>
                                    <td>
                                        <div class="product-cell">
                                            <span class="product-image">{{ product.image }}</span>
                                            <span>{{ product.name }}</span>
                                        </div>
                                    </td>
                                    <td>{{ getSubcategoryName(product.subcategoryId) }}</td>
                                    <td>{{ formatDate(product.createdDate) }}</td>
                                    <td>{{ product.orderCount }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="edit-btn" title="Edit" (click)="editProduct(product)">
                                                ‚úèÔ∏è
                                            </button>
                                            <button class="delete-btn" title="Delete"
                                                (click)="deleteProduct(product.id)">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div *ngIf="products.length === 0" class="no-products">
                            <p>No products found</p>
                        </div>
                    </div>
                </div>

                <div class="pagination-section">
                    <button class="pagination-btn prev-btn" [disabled]="pagination.currentPage === 1"
                        (click)="previousPage()">
                        ‚Üê Previous
                    </button>

                    <div class="page-numbers">
                        <button *ngFor="let pageNum of getPageNumbers()" [class.active]="isPageActive(pageNum)"
                            class="page-btn" (click)="goToPage(pageNum)">
                            {{ pageNum }}
                        </button>

                        <span class="page-dots"
                            *ngIf="getPageNumbers()[getPageNumbers().length - 1] < pagination.totalPages">
                            ....
                        </span>

                        <button *ngIf="getPageNumbers()[getPageNumbers().length - 1] < pagination.totalPages"
                            class="page-btn" (click)="goToPage(pagination.totalPages)">
                            {{ pagination.totalPages }}
                        </button>
                    </div>

                    <button class="pagination-btn next-btn"
                        [disabled]="pagination.currentPage === pagination.totalPages" (click)="nextPage()">
                        Next ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Detail Page -->
<div class="container-fluid bgpad" *ngIf="IsDetailPage">
    <div class="row">
        <div class="products-container">
            <header class="page-header">
                <h1>Orders Details</h1>
                <div class="header-row">
                    <div class="breadcrumb">
                        <span>Home</span>
                        <span class="separator">></span>
                        <span>Order List</span>
                        <span class="separator">></span>
                        <span class="active">Order Details</span>
                    </div>
                    <!-- <button class="btn-shipped" (click)="markAsShipped()">
                        Mark as Shipped
                    </button> -->
                    <button class="btn-shipped" (click)="handleOrderAction()">
                        {{ orderData.status === 'Pending' ? 'Mark as Shipped' : 'Mark as Delivered' }}
                    </button>

                </div>
            </header>

            <div class="subcategory-section">
                <div class="order-header">
                    <div class="order-id-section">
                        <h2>Orders ID: {{ orderData.orderId }}</h2>
                        <span class="status-badge" [class.pending]="orderData.status === 'Pending'"
                            [class.shipped]="orderData.status === 'Shipped'">
                            {{ orderData.status }}
                        </span>
                    </div>

                </div>
                <div class="info-cards">
                    <div class="info-card">
                        <div class="card-header">
                            <div class="icon-wrapper">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <h3>Customer</h3>
                        </div>
                        <div class="card-content">
                            <p class="label">Full Name: <span class="value">{{ orderData.customer.fullName
                                    }}</span><br />
                                Email: <span class="value">{{ orderData.customer.email }}</span><br />
                                Phone: <span class="value">{{ orderData.customer.phone }}</span>

                            </p>
                            <!-- <p class="label">Email: <span class="value">{{ orderData.customer.email }}</span></p>
                            <p class="label">Phone: <span class="value">{{ orderData.customer.phone }}</span></p> -->
                        </div>
                        <!-- <button class="btn-card" (click)="viewProfile()">View profile</button> -->
                    </div>

                    <!-- <div class="info-card">
                        <div class="card-header">
                            <div class="icon-wrapper">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </div>
                            <h3>Order Info</h3>
                        </div>
                        <div class="card-content">
                            <p class="label">Shipping: <span class="value">{{ orderData.orderInfo.shipping
                                    }}</span><br />
                                Payment Method: <span class="value">{{ orderData.orderInfo.paymentMethod
                                    }}</span><br />
                                Status: <span class="value">{{ orderData.orderInfo.status }}</span>
                            </p>
                        </div>
                        <button class="btn-card" (click)="downloadInfo()">Download info</button>
                    </div> -->

                    <div class="info-card">
                        <div class="card-header">
                            <div class="icon-wrapper">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                            </div>
                            <h3>Deliver to</h3>
                        </div>
                        <div class="card-content">
                            <p class="label">Address: <span class="value">{{ orderData.deliveryAddress.address
                                    }}</span><br />
                                <span class="value">{{ orderData.deliveryAddress.city }}</span><br />
                                <span class="value">{{ orderData.deliveryAddress.state }}</span>
                            </p>

                        </div>
                        <!-- <button class="btn-card" (click)="viewProfile()">View profile</button> -->
                    </div>


                    <div class="info-card">
                        <div class="card-header">
                            <div class="icon-wrapper">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                            </div>
                            <h3>Payment Info</h3>
                        </div>
                        <div class="card-content">
                            <p class="payment-detail">Business name: {{ orderData.payment.businessName }}
                                <br />
                                Phone: {{ orderData.payment.phone }}
                            </p>
                        </div>
                        <!-- <button class="btn-card" (click)="viewProfile()">View profile</button> -->
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="products-container">
            <div class="products-section">
                <div class="section-header">
                    <h3>Products</h3>

                </div>

                <div class="products-table">
                    <div class="table-header">
                        <div class="col-checkbox"></div>
                        <div class="col-product">Product Name</div>
                        <div class="col-order-id">Order ID</div>
                        <div class="col-quantity">Quantity</div>
                        <div class="col-quantity"></div>
                        <div class="col-total">Total</div>
                    </div>

                    <div class="table-body">
                        <div class="table-row" *ngFor="let product of orderData.products">
                            <div class="col-checkbox">
                                <!-- <input type="checkbox" [checked]="product.selected" (change)="toggleProduct(product)" /> -->
                            </div>
                            <div class="col-product">
                                <img [src]="product.image" [alt]="product.name" class="product-image" />
                                <span>{{ product.name }}</span>
                            </div>
                            <div class="col-order-id">{{ product.orderId }}</div>
                            <div class="col-quantity">{{ product.quantity }}</div>
                            <div class="col-quantity"></div>
                            <div class="col-total">‚Çπ{{ product.total.toFixed(2) }}</div>
                        </div>
                    </div>

                    <div class="table-summary">
                        <div class="summary-row">
                            <span class="summary-label">Subtotal</span>
                            <span class="summary-value">‚Çπ{{ orderData.subtotal.toFixed(2) }}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Tax ({{ getTaxPercentage() }}%)</span>
                            <span class="summary-value">‚Çπ{{ orderData.tax.toFixed(2) }}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Discount</span>
                            <span class="summary-value">‚Çπ{{ orderData.discount }}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Sipping Rate</span>
                            <span class="summary-value">‚Çπ{{ orderData.shippingRate }}</span>
                        </div>
                        <div class="summary-row total-row">
                            <span class="summary-label">Total</span>
                            <span class="summary-value">‚Çπ{{ orderData.total.toFixed(2) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>